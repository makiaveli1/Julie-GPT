{% extends 'base.html' %} 
{% load static %} 

{% block styles %}
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'css/style_chatbot.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'css/custom_styles.css' %}" type="text/css" />
{% endblock %} 

{% block content %}
<div class="container">
  
  <!-- Profile Button -->
  <div class="username-container">
    <button id="open-profile-btn" class="btn btn-primary btn-md profile-btn" data-toggle="modal" data-target="#profileDisplayModal">
      Profile
    </button>
  </div>
  
  <!-- Bootstrap Modal for Displaying Profile -->
  <div class="modal fade" id="profileDisplayModal" tabindex="-1" aria-labelledby="profileDisplayModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="profileDisplayModalLabel">Profile Information</h5>
        </div>
        <div class="modal-body">
            <!-- Display Name -->
            <div class="form-group">
              <label>Full Name:</label>
              <p id="display-full-name"><!-- User's Full Name --></p>
            </div>
            <!-- Display Email -->
            <div class="form-group">
              <label>Email:</label>
              <p id="display-email"><!-- User's Email --></p>
            </div>
            <!-- Display Phone -->
            <div class="form-group">
              <label>Phone Number:</label>
              <p id="display-phone"><!-- User's Phone --></p>
            </div>
            <!-- Display Bio -->
            <div class="form-group">
              <label>Bio:</label>
              <p id="display-bio"><!-- User's Bio --></p>
            </div>
            <!-- Display Social Media Links -->
            <div class="form-group">
              <label>Social Media Links:</label>
              <p id="display-social"><!-- User's Social Media Links --></p>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button id="edit-profile-btn" type="button" class="btn btn-primary">Edit</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="profileModalLabel">Profile Settings</h5>
        </div>
        <div class="modal-body">
          <form id="profile-form">
            <!-- Name -->
            <div class="form-group">
              <label for="user-full-name">Full Name:</label>
              <input type="text" id="user-full-name" name="full_name" class="form-control" required />
            </div>
            <!-- Email -->
            <div class="form-group">
              <label for="user-email">Email:</label>
              <input type="email" id="user-email" name="email" class="form-control" required />
            </div>
            <!-- Password Update -->
            <div class="form-group">
              <label for="user-password">Password:</label>
              <input type="password" id="user-password" name="password" class="form-control" />
              <small>Leave blank to keep the current password.</small>
            </div>
            <!-- Phone -->
            <div class="form-group">
              <label for="user-phone">Phone Number:</label>
              <input type="tel" id="user-phone" name="phone" class="form-control" />
            </div>
            <!-- Bio -->
            <div class="form-group">
              <label for="user-bio">Bio:</label>
              <textarea id="user-bio" name="bio" class="form-control"></textarea>
            </div>
            <!-- Profile Picture -->
            <div class="form-group">
              <label for="profile-picture">Profile Picture:</label>
              <input type="file" id="profile-picture" name="profile_picture" class="form-control" accept="image/*" />
            </div>
            <!-- Social Media Links -->
            <div class="form-group">
              <label for="user-social">Social Media Links:</label>
              <input type="url" id="user-social" name="social_media" class="form-control" />
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" form="profile-form" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Auth Buttons -->
  <div class="auth-buttons text-end">
    {% if not user.is_authenticated %}
    <a href="{% url 'login' %}" class="btn btn-primary btn-md" role="button">Login</a>
    {% else %}
    <a href="{% url 'logout' %}" class="btn btn-danger btn-md" role="button">Logout</a>
    {% endif %}
  </div>
  
  <!-- Chatbox -->
  <div class="chatbox">
    <header class="sticky-top">Talk to JULIE:</header>
    <div id="chat-container">
      {% for chat in chats %}
      <div class="message user-message">
        <i class="fas fa-user avatar"></i>
        <span class="message-text">{{ chat.message|escape }}</span>
        <span class="timestamp">{{ chat.timestamp|date:"H:i" }}</span>
      </div>
      <div class="message chatbot-message">
        <img src="{% static 'images/julie.jpg' %}" alt="Julie" class="avatar chatbot-avatar" />
        <span class="message-text">{{ chat.response|escape }}</span>
        <span class="timestamp">{{ chat.timestamp|date:"H:i" }}</span>
      </div>
      {% endfor %}
    </div>
    <div class="input-container">
      <form id="chat-form">
        {% csrf_token %}
        <input name="message" placeholder="Type a message..." type="text" class="form-control" />
        <button type="submit" class="btn btn-primary send-btn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </form>
<!-- Toast Container -->
<div aria-live="polite" aria-atomic="true" class="position-fixed bottom-0 end-0 p-3">
  <div id="toast-container" class="toast-container"></div>
</div>

{% endblock %} 

{% block scripts %}
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'static/js/script_chatbot.js' %}"></script>
{% endblock %}
